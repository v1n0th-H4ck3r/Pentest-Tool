import requests
import re
import socket

def find_subdomains(domain):
    subdomains_with_ips = {}

    try:
        # Query crt.sh for subdomains
        url = f"https://crt.sh/?q=%25.{domain}&output=json"
        response = requests.get(url)
        if response.status_code == 200:
            data = response.json()
            for entry in data:
                name_value = entry['name_value']
                if '*' not in name_value:  # Exclude wildcard subdomains
                    if name_value not in subdomains_with_ips:
                        ip_addresses = resolve_domain(name_value)
                        if ip_addresses is not None:
                            subdomains_with_ips[name_value] = ip_addresses
        else:
            print(f"Error querying crt.sh: {response.status_code}")
    except Exception as e:
        print(f"An error occurred: {e}")

    return subdomains_with_ips

def resolve_domain(domain):
    try:
        ip_addresses = socket.gethostbyname_ex(domain)[2]
        return ip_addresses
    except socket.gaierror:
        return None

